
// pine lcd code

#include "nrf.h"
#include "nrf_gpio.h"
#include "nrf_delay.h"

#include "lcd.h"

const unsigned char funfont_4x8b[]={
0x00,0x00,0x00,0x00, // 32 
0x00,0x74,0x00,0x00, // 33 
0x60,0x00,0x60,0x00, // 34 
0x7c,0x28,0x7c,0x00, // 35 
0x34,0x7c,0x58,0x00, // 36 
0x48,0x10,0x24,0x00, // 37 
0x28,0x54,0x2c,0x00, // 38 
0x00,0x60,0x00,0x00, // 39 
0x00,0x38,0x44,0x00, // 40 
0x44,0x38,0x00,0x00, // 41 
0x54,0x38,0x54,0x00, // 42 
0x10,0x38,0x10,0x00, // 43 
0x00,0x06,0x00,0x00, // 44 
0x10,0x10,0x10,0x00, // 45 
0x00,0x0c,0x0c,0x00, // 46 
0x08,0x10,0x20,0x00, // 47 
0x7c,0x44,0x7c,0x00, // 48 
0x44,0x7c,0x04,0x00, // 49 
0x5c,0x54,0x74,0x00, // 50 
0x54,0x54,0x7c,0x00, // 51 
0x70,0x10,0x7c,0x00, // 52 
0x74,0x54,0x5c,0x00, // 53 
0x7c,0x54,0x5c,0x00, // 54 
0x40,0x40,0x7c,0x00, // 55 
0x7c,0x54,0x7c,0x00, // 56 
0x70,0x50,0x7c,0x00, // 57 
0x00,0x6c,0x6c,0x00, // 58 
0x00,0x66,0x60,0x00, // 59 
0x10,0x28,0x44,0x00, // 60 
0x28,0x28,0x28,0x00, // 61 
0x44,0x28,0x10,0x00, // 62 
0x60,0x5c,0x70,0x00, // 63 
0x7c,0x54,0x74,0x00, // 64 
0x7c,0x50,0x7c,0x00, // 65 
0x7c,0x54,0x6c,0x00, // 66 
0x7c,0x44,0x44,0x00, // 67 
0x7c,0x44,0x38,0x00, // 68 
0x7c,0x54,0x44,0x00, // 69 
0x7c,0x50,0x40,0x00, // 70 
0x7c,0x44,0x4c,0x00, // 71 
0x7c,0x10,0x7c,0x00, // 72 
0x44,0x7c,0x44,0x00, // 73 
0x0c,0x44,0x7c,0x00, // 74 
0x7c,0x10,0x6c,0x00, // 75 
0x7c,0x04,0x04,0x00, // 76 
0x7c,0x30,0x7c,0x00, // 77 
0x7c,0x40,0x7c,0x00, // 78 
0x3c,0x44,0x78,0x00, // 79 
0x7c,0x50,0x70,0x00, // 80 
0x3c,0x4c,0x7c,0x00, // 81 
0x7c,0x50,0x6c,0x00, // 82 
0x64,0x54,0x4c,0x00, // 83 
0x40,0x7c,0x40,0x00, // 84 
0x7c,0x04,0x7c,0x00, // 85 
0x70,0x0c,0x70,0x00, // 86 
0x7c,0x18,0x7c,0x00, // 87 
0x6c,0x10,0x6c,0x00, // 88 
0x70,0x1c,0x70,0x00, // 89 
0x4c,0x54,0x64,0x00, // 90 
0x00,0x7c,0x44,0x00, // 91 
0x20,0x10,0x08,0x00, // 92 
0x44,0x7c,0x00,0x00, // 93 
0x20,0x40,0x20,0x00, // 94 
0x04,0x04,0x04,0x00, // 95 
0x00,0x40,0x20,0x00, // 96 
0x2c,0x2c,0x3c,0x00, // 97 
0x7c,0x24,0x3c,0x00, // 98 
0x3c,0x24,0x24,0x00, // 99 
0x3c,0x24,0x7c,0x00, // 100 
0x3c,0x34,0x34,0x00, // 101 
0x10,0x7c,0x50,0x00, // 102 
0x3d,0x25,0x3f,0x00, // 103 
0x7c,0x20,0x3c,0x00, // 104 
0x24,0x7c,0x04,0x00, // 105 
0x0c,0x04,0x7c,0x00, // 106 
0x7c,0x10,0x2c,0x00, // 107 
0x40,0x7c,0x04,0x00, // 108 
0x3c,0x30,0x3c,0x00, // 109 
0x3c,0x20,0x3c,0x00, // 110 
0x3c,0x24,0x3c,0x00, // 111 
0x3f,0x24,0x3c,0x00, // 112 
0x3c,0x24,0x3f,0x00, // 113 
0x3c,0x20,0x20,0x00, // 114 
0x34,0x34,0x2c,0x00, // 115 
0x20,0x7c,0x24,0x00, // 116 
0x3c,0x04,0x3c,0x00, // 117 
0x38,0x04,0x38,0x00, // 118 
0x3c,0x0c,0x3c,0x00, // 119 
0x24,0x18,0x24,0x00, // 120 
0x3d,0x05,0x3f,0x00, // 121 
0x2c,0x2c,0x34,0x00, // 122 
0x00,0x28,0x54,0x00, // 123 
0x00,0x7c,0x00,0x00, // 124 
0x54,0x28,0x00,0x00, // 125 
0x40,0x20,0x40,0x00, // 126 
0x7c,0x7c,0x7c,0x00  // 127 
};

const unsigned short funfont_8x16r[]={
0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000, // 32 
0x0000,0x0000,0x0000,0x3f30,0x0000,0x0000,0x0000,0x0000, // 33 
0x0000,0x1000,0x6000,0x0000,0x1000,0x6000,0x0000,0x0000, // 34 
0x0480,0x0480,0x3ff0,0x0480,0x3ff0,0x0480,0x0480,0x0000, // 35 
0x0000,0x1c40,0x2220,0x7ff0,0x2220,0x11c0,0x0000,0x0000, // 36 
0x1800,0x2430,0x18c0,0x0300,0x0c60,0x3090,0x0060,0x0000, // 37 
0x0000,0x18e0,0x2510,0x2210,0x2590,0x1860,0x0190,0x0000, // 38 
0x0000,0x0000,0x1000,0x6000,0x0000,0x0000,0x0000,0x0000, // 39 
0x0000,0x0000,0x0fc0,0x3030,0x0000,0x0000,0x0000,0x0000, // 40 
0x0000,0x0000,0x3030,0x0fc0,0x0000,0x0000,0x0000,0x0000, // 41 
0x0000,0x0540,0x0380,0x0fe0,0x0380,0x0540,0x0000,0x0000, // 42 
0x0000,0x0100,0x0100,0x0fe0,0x0100,0x0100,0x0000,0x0000, // 43 
0x0000,0x0000,0x0008,0x0030,0x0000,0x0000,0x0000,0x0000, // 44 
0x0000,0x0100,0x0100,0x0100,0x0100,0x0100,0x0000,0x0000, // 45 
0x0000,0x0000,0x0000,0x0030,0x0000,0x0000,0x0000,0x0000, // 46 
0x0000,0x0030,0x00c0,0x0300,0x0c00,0x3000,0x0000,0x0000, // 47 
0x0000,0x3ff0,0x2010,0x2010,0x2010,0x2010,0x3ff0,0x0000, // 48 
0x0000,0x2010,0x2010,0x3ff0,0x0010,0x0010,0x0000,0x0000, // 49 
0x0000,0x23f0,0x2210,0x2210,0x2210,0x2210,0x3e10,0x0000, // 50 
0x0000,0x2210,0x2210,0x2210,0x2210,0x2210,0x3ff0,0x0000, // 51 
0x0000,0x3e00,0x0200,0x0200,0x0200,0x0200,0x3ff0,0x0000, // 52 
0x0000,0x3e10,0x2210,0x2210,0x2210,0x2210,0x23f0,0x0000, // 53 
0x0000,0x3ff0,0x2210,0x2210,0x2210,0x2210,0x23f0,0x0000, // 54 
0x0000,0x2000,0x2000,0x2000,0x2000,0x2000,0x3ff0,0x0000, // 55 
0x0000,0x3ff0,0x2210,0x2210,0x2210,0x2210,0x3ff0,0x0000, // 56 
0x0000,0x3e00,0x2200,0x2200,0x2200,0x2200,0x3ff0,0x0000, // 57 
0x0000,0x0000,0x0000,0x1860,0x0000,0x0000,0x0000,0x0000, // 58 
0x0000,0x0000,0x0010,0x1860,0x0000,0x0000,0x0000,0x0000, // 59 
0x0000,0x0000,0x0300,0x0cc0,0x3030,0x0000,0x0000,0x0000, // 60 
0x0000,0x0480,0x0480,0x0480,0x0480,0x0480,0x0000,0x0000, // 61 
0x0000,0x0000,0x0000,0x3030,0x0cc0,0x0300,0x0000,0x0000, // 62 
0x0000,0x1c00,0x2000,0x21b0,0x2200,0x2200,0x1c00,0x0000, // 63 
0x0000,0x1fe0,0x2010,0x2210,0x2510,0x2110,0x1e20,0x0000, // 64 
0x0000,0x1ff0,0x2200,0x2200,0x2200,0x2200,0x1ff0,0x0000, // 65 
0x0000,0x3ff0,0x2210,0x2210,0x2210,0x2210,0x1de0,0x0000, // 66 
0x0000,0x1fe0,0x2010,0x2010,0x2010,0x2010,0x1860,0x0000, // 67 
0x0000,0x3ff0,0x2010,0x2010,0x2010,0x2010,0x1fe0,0x0000, // 68 
0x0000,0x3ff0,0x2210,0x2210,0x2210,0x2010,0x2010,0x0000, // 69 
0x0000,0x3ff0,0x2200,0x2200,0x2200,0x2000,0x2000,0x0000, // 70 
0x0000,0x3ff0,0x2010,0x2010,0x2210,0x2210,0x23f0,0x0000, // 71 
0x0000,0x3ff0,0x0200,0x0200,0x0200,0x0200,0x3ff0,0x0000, // 72 
0x0000,0x2010,0x2010,0x3ff0,0x2010,0x2010,0x0000,0x0000, // 73 
0x0000,0x00f0,0x0010,0x2010,0x2010,0x2010,0x3ff0,0x0000, // 74 
0x0000,0x3ff0,0x0300,0x0480,0x0840,0x1020,0x2010,0x0000, // 75 
0x0000,0x3ff0,0x0010,0x0010,0x0010,0x0010,0x0010,0x0000, // 76 
0x0000,0x3ff0,0x1000,0x0800,0x0800,0x1000,0x3ff0,0x0000, // 77 
0x0000,0x3ff0,0x2000,0x2000,0x2000,0x2000,0x3ff0,0x0000, // 78 
0x0000,0x1fe0,0x2010,0x2010,0x2010,0x2010,0x1fe0,0x0000, // 79 
0x0000,0x3ff0,0x2200,0x2200,0x2200,0x2200,0x1c00,0x0000, // 80 
0x0000,0x1fe0,0x2010,0x2010,0x2010,0x2030,0x1ff0,0x0000, // 81 
0x0000,0x3ff0,0x2200,0x2200,0x2200,0x2200,0x1df0,0x0000, // 82 
0x0000,0x1c10,0x2210,0x2210,0x2210,0x2210,0x21e0,0x0000, // 83 
0x0000,0x2000,0x2000,0x3ff0,0x2000,0x2000,0x0000,0x0000, // 84 
0x0000,0x3fe0,0x0010,0x0010,0x0010,0x0010,0x3fe0,0x0000, // 85 
0x0000,0x3fc0,0x0020,0x0010,0x0010,0x0020,0x3fc0,0x0000, // 86 
0x0000,0x3ff0,0x0020,0x0040,0x0040,0x0020,0x3ff0,0x0000, // 87 
0x0000,0x38f0,0x0500,0x0200,0x0200,0x0500,0x38f0,0x0000, // 88 
0x0000,0x3e00,0x0200,0x03f0,0x0200,0x3e00,0x0000,0x0000, // 89 
0x0000,0x2070,0x2090,0x2110,0x2210,0x2410,0x3810,0x0000, // 90 
0x0000,0x0000,0x3ff0,0x2010,0x2010,0x2010,0x0000,0x0000, // 91 
0x0000,0x3000,0x0c00,0x0300,0x00c0,0x0030,0x0000,0x0000, // 92 
0x0000,0x2010,0x2010,0x2010,0x3ff0,0x0000,0x0000,0x0000, // 93 
0x0000,0x0800,0x1000,0x2000,0x1000,0x0800,0x0000,0x0000, // 94 
0x0000,0x0008,0x0008,0x0008,0x0008,0x0008,0x0000,0x0000, // 95 
0x0000,0x0000,0x0000,0x6000,0x1000,0x0000,0x0000,0x0000, // 96 
0x0000,0x0260,0x0490,0x0490,0x0490,0x0490,0x03f0,0x0000, // 97 
0x0000,0x3ff0,0x0410,0x0410,0x0410,0x0410,0x03e0,0x0000, // 98 
0x0000,0x03e0,0x0410,0x0410,0x0410,0x0410,0x0410,0x0000, // 99 
0x0000,0x03e0,0x0410,0x0410,0x0410,0x0410,0x3ff0,0x0000, // 100 
0x0000,0x03e0,0x0490,0x0490,0x0490,0x0490,0x0320,0x0000, // 101 
0x0000,0x0400,0x0400,0x1ff0,0x2400,0x2400,0x2000,0x0000, // 102 
0x0000,0x03e2,0x0411,0x0411,0x0411,0x0411,0x03fe,0x0000, // 103 
0x0000,0x3ff0,0x0400,0x0400,0x0400,0x0400,0x03f0,0x0000, // 104 
0x0000,0x0000,0x0410,0x37f0,0x0010,0x0000,0x0000,0x0000, // 105 
0x0000,0x00f0,0x0010,0x0010,0x0010,0x0010,0x37f0,0x0000, // 106 
0x0000,0x3ff0,0x0100,0x0280,0x0440,0x0020,0x0010,0x0000, // 107 
0x0000,0x0000,0x2000,0x3ff0,0x0010,0x0010,0x0010,0x0000, // 108 
0x0000,0x07f0,0x0400,0x0200,0x0200,0x0400,0x07f0,0x0000, // 109 
0x0000,0x07f0,0x0400,0x0400,0x0400,0x0400,0x07f0,0x0000, // 110 
0x0000,0x03e0,0x0410,0x0410,0x0410,0x0410,0x03e0,0x0000, // 111 
0x0000,0x07ff,0x0410,0x0410,0x0410,0x0410,0x03e0,0x0000, // 112 
0x0000,0x03e0,0x0410,0x0410,0x0410,0x0410,0x07ff,0x0000, // 113 
0x0000,0x07f0,0x0400,0x0400,0x0400,0x0400,0x0200,0x0000, // 114 
0x0000,0x0310,0x0490,0x0490,0x0490,0x0490,0x0460,0x0000, // 115 
0x0000,0x0400,0x0400,0x3ff0,0x0410,0x0410,0x0010,0x0000, // 116 
0x0000,0x07e0,0x0010,0x0010,0x0010,0x0010,0x07e0,0x0000, // 117 
0x0000,0x07c0,0x0020,0x0010,0x0010,0x0020,0x07c0,0x0000, // 118 
0x0000,0x07f0,0x0020,0x0040,0x0040,0x0020,0x07f0,0x0000, // 119 
0x0000,0x0630,0x0140,0x0080,0x0080,0x0140,0x0630,0x0000, // 120 
0x0000,0x07e1,0x0011,0x0011,0x0011,0x0011,0x07fe,0x0000, // 121 
0x0000,0x0430,0x0450,0x0490,0x0510,0x0610,0x0410,0x0000, // 122 
0x0000,0x0000,0x0cc0,0x3330,0x0000,0x0000,0x0000,0x0000, // 123 
0x0000,0x0000,0x0000,0x3ff0,0x0000,0x0000,0x0000,0x0000, // 124 
0x0000,0x0000,0x3330,0x0cc0,0x0000,0x0000,0x0000,0x0000, // 125 
0x0800,0x1000,0x2000,0x1000,0x0800,0x1000,0x2000,0x0000, // 126 
0x0000,0x3ff0,0x3ff0,0x3ff0,0x3ff0,0x3ff0,0x3ff0,0x0000  // 127 
};


int shader_textline(int x,int y,struct shader_font *data)
{
	int cx;
	int px;
	int code;
	int bits;

	x=((x+data->ax)*data->mx)/data->dx;
	y=((y+data->ay)*data->my)/data->dy;

	switch(data->hy)
	{
		case 8:
			cx=x/4;
			px=x%4;
			if(cx>=data->length) { return data->background; }
			code=data->text[cx];
			bits=((const char *)data->name)[ (code-32)*4 + px ];
			if( bits & ( 1 << (7-y) ) ) { return data->foreground; }
			bits=((const char *)data->name)[ (code-32)*4 + px - 1 ];
			if( bits & ( 1 << (6-y) ) ) { return data->dropshadow; }
			return data->background;
		break;

		case 16:
			cx=x/8;
			px=x%8;
			if(cx>=data->length) { return data->background; }
			code=data->text[cx];
			bits=((const short *)data->name)[ (code-32)*8 + px ];
			if( bits & ( 1 << (15-y) ) ) { return data->foreground; }
			bits=((const short *)data->name)[ (code-32)*8 + px - 1 ];
			if( bits & ( 1 << (14-y) ) ) { return data->dropshadow; }
			return data->background;
		break;
	}
	return data->background;
}


